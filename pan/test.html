<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>测试登录</title>
</head>
<body>
  <h2>测试登录面板</h2>
  <input type="password" id="pwd" placeholder="输入密码">
  <button onclick="login()">登录</button>
  <div id="result" style="margin-top:1em;color:gray">等待登录...</div>

  <script>
    async function login() {
      const pwd = document.getElementById("pwd").value.trim();
      const result = document.getElementById("result");

      console.log("login() 被调用，输入密码 =", pwd);
      if (!pwd) {
        result.textContent = "❌ 请输入密码";
        result.style.color = "red";
        return;
      }

      try {
        const res = await fetch("https://pan.0515364.xyz/whoami", {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: pwd
        });

        if (!res.ok) throw new Error("网络错误：" + res.status);
        const data = await res.json();
        console.log("返回结果 =", data);

        if (data.role) {
          result.textContent = `✅ 登录成功，角色：${data.role}`;
          result.style.color = "green";
        } else {
          result.textContent = "❌ 密码错误";
          result.style.color = "red";
        }
      } catch (err) {
        console.error("登录异常：", err);
        result.textContent = "❌ 异常：" + err.message;
        result.style.color = "red";
      }
    }

    // 明确挂载
    window.login = login;
  </script>
</body>
</html>