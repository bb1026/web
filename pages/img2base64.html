<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ÂõæÁâá ‚Üî Base64 ËΩ¨Êç¢Â∑•ÂÖ∑</title>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --success-color: #4cc9f0;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --border-radius: 12px;
      --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      color: var(--dark-color);
      background-color: #f5f7ff;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin: 20px 0 40px;
      color: var(--primary-color);
      font-weight: 600;
      font-size: clamp(1.8rem, 4vw, 2.5rem);
    }

    .card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      margin-bottom: 30px;
      transition: var(--transition);
      position: relative;
    }

    .card:hover {
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
    }

    .card h2 {
      color: var(--secondary-color);
      margin-bottom: 20px;
      font-size: 1.4rem;
      font-weight: 500;
    }

    .drag-area {
      border: 2px dashed var(--primary-color);
      border-radius: var(--border-radius);
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background-color: rgba(67, 97, 238, 0.05);
      margin-bottom: 15px;
    }

    .drag-area:hover {
      background-color: rgba(67, 97, 238, 0.1);
    }

    .drag-area.dragover {
      background-color: rgba(67, 97, 238, 0.2);
      border-color: var(--secondary-color);
    }

    .drag-area .icon {
      font-size: 48px;
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .drag-area .text {
      font-size: 1.1rem;
      color: var(--dark-color);
      margin-bottom: 10px;
    }

    .drag-area .hint {
      font-size: 0.9rem;
      color: #6c757d;
    }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 1px solid #dee2e6;
      border-radius: var(--border-radius);
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.95rem;
      resize: vertical;
      transition: var(--transition);
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 15px;
    }

    .btn:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
    }

    .btn-block {
      display: block;
      width: 100%;
    }

    .file-info {
      font-size: 0.9rem;
      color: #495057;
      margin: 10px 0;
      padding: 10px;
      background-color: var(--light-color);
      border-radius: 6px;
    }

    .preview-container {
      margin-top: 20px;
      text-align: center;
      position: relative;
      display: inline-block;
    }

    .preview-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: none;
    }

    .download-btn {
      display: none;
      margin-top: 15px;
      background-color: var(--success-color);
    }

    .download-btn:hover {
      background-color: #38b6db;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 14px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: var(--transition);
    }

    .close-btn:hover {
      background: rgba(0, 0, 0, 0.8);
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .card {
        padding: 20px;
      }

      .drag-area {
        padding: 30px 15px;
      }

      .btn {
        padding: 10px 20px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }

      h1 {
        margin: 10px 0 30px;
      }

      .drag-area .icon {
        font-size: 36px;
      }

      .drag-area .text {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ÂõæÁâá ‚Üî Base64 ËΩ¨Êç¢Â∑•ÂÖ∑</h1>

    <div class="card">
      <h2>ÂõæÁâáËΩ¨ Base64</h2>
      <div class="drag-area" id="dragArea">
        <div class="icon">üìÅ</div>
        <div class="text">ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</div>
        <div class="hint">ÊîØÊåÅ JPG, PNG, GIF Á≠âÊ†ºÂºè</div>
        <input type="file" id="fileInput" accept="image/*" hidden>
      </div>
      <div id="fileInfo" class="file-info"></div>
      <textarea id="base64Output" placeholder="ÁîüÊàêÁöÑ Base64 ÁºñÁ†ÅÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå..." readonly></textarea>
      <button class="btn btn-block" onclick="copyBase64()">Â§çÂà∂ Base64 ÁºñÁ†Å</button>
      <div class="preview-container">
        <img id="previewImage" class="preview-image" alt="ÂõæÁâáÈ¢ÑËßà"/>
        <button class="close-btn" onclick="clearUploadedImage()" id="closeUploadBtn">√ó</button>
      </div>
    </div>

    <div class="card">
      <h2>Base64 ËΩ¨ÂõæÁâá</h2>
      <textarea id="base64Input" placeholder="Âú®Ê≠§Á≤òË¥¥ Base64 ÂõæÁâáÁºñÁ†Å..."></textarea>
      <button class="btn btn-block" onclick="base64ToImage()">ËΩ¨Êç¢‰∏∫ÂõæÁâá</button>
      <div class="preview-container">
        <img id="outputImage" class="preview-image" alt="ÁîüÊàêÁöÑÂõæÁâá"/>
        <button class="close-btn" onclick="clearGeneratedImage(true)" id="closeGeneratedBtn">√ó</button>
      </div>
      <button id="downloadLink" class="btn btn-block download-btn">‰∏ãËΩΩÂõæÁâá</button>
    </div>
  </div>

  <script>
  // Áî®‰∫éÊ†áËÆ∞ÊòØÂê¶‰∏∫Áî®Êà∑‰∏ªÂä®Ê∏ÖÈô§ÂõæÁâáÔºåÈÅøÂÖçËß¶ÂèëÈîôËØØÊèêÁ§∫
  let userClearing = false;

  document.addEventListener('DOMContentLoaded', function () {
    const fileInput = document.getElementById('fileInput');
    const dragArea = document.getElementById('dragArea');

    dragArea.addEventListener('click', () => fileInput.click());

    dragArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      dragArea.classList.add('dragover');
    });

    dragArea.addEventListener('dragleave', () => {
      dragArea.classList.remove('dragover');
    });

    dragArea.addEventListener('drop', (e) => {
      e.preventDefault();
      dragArea.classList.remove('dragover');
      if (e.dataTransfer.files.length) {
        processImageFile(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        processImageFile(fileInput.files[0]);
      }
    });

    function processImageFile(file) {
      if (!file || !file.type.startsWith('image/')) {
        alert('ËØ∑ÈÄâÊã©ÊúâÊïàÁöÑÂõæÁâáÊñá‰ª∂ÔºÅ');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const base64Data = e.target.result;
        const previewImage = document.getElementById('previewImage');
        const fileInfo = document.getElementById('fileInfo');

        document.getElementById('base64Output').value = base64Data;
        previewImage.src = base64Data;
        previewImage.style.display = 'block';
        toggleCloseButtons();

        fileInfo.innerHTML = `
          <strong>${file.name}</strong><br>
          Â§ßÂ∞è: ${(file.size / 1024).toFixed(1)} KB |
          Á±ªÂûã: ${file.type} |
          Â∞∫ÂØ∏: <span id="imageDimensions">ËÆ°ÁÆó‰∏≠...</span>
        `;

        const img = new Image();
        img.onload = function () {
          document.getElementById('imageDimensions').textContent =
            `${this.width} √ó ${this.height} ÂÉèÁ¥†`;
        };
        img.src = base64Data;
      };

      reader.onerror = () => alert('ËØªÂèñÊñá‰ª∂Êó∂Âá∫ÈîôÔºåËØ∑ÈáçËØïÔºÅ');
      reader.readAsDataURL(file);
    }
  });

  // ‚úÖ ‰øÆÂ§çÔºö‰∏çÂÜçÈÄâ‰∏≠ÊñáÊú¨ÔºåÂè™Â§çÂà∂ÂÜÖÂÆπ
  function copyBase64() {
    const text = document.getElementById('base64Output').value;
    if (!text) return;

    navigator.clipboard.writeText(text)
      .then(() => showToast('Base64 ÁºñÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ'))
      .catch(() => alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÊñáÊú¨'));
  }

  function base64ToImage() {
    const data = document.getElementById('base64Input').value.trim();
    if (!data) return;

    if (!data.startsWith('data:image/')) {
      showToast('ËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑBase64ÂõæÁâáÊï∞ÊçÆÔºàÂøÖÈ°ª‰ª•"data:image/"ÂºÄÂ§¥Ôºâ', 'error');
      return;
    }

    const output = document.getElementById('outputImage');
    const downloadBtn = document.getElementById('downloadLink');

    output.onload = () => {
      output.style.display = 'block';
      downloadBtn.style.display = 'block';
      toggleCloseButtons();
    };

    // ‚úÖ ‰øÆÂ§çÔºö‰ªÖÂú®ÈùûÁî®Êà∑Ê∏ÖÈô§Êó∂ÊâçÊèêÁ§∫ÈîôËØØ
    output.onerror = () => {
      if (!userClearing && data.length > 10) {
        showToast('Êó†ÊïàÁöÑBase64ÂõæÁâáÊï∞ÊçÆÔºÅ', 'error');
      }
      output.style.display = 'none';
      downloadBtn.style.display = 'none';
      toggleCloseButtons();
    };

    output.src = data;

    downloadBtn.onclick = () => {
      const link = document.createElement('a');
      link.href = data;
      link.download = `image_${Date.now()}.${getImageExtension(data)}`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };
  }

  // ‚úÖ Ê†áËÆ∞Áî®Êà∑Ê≠£Âú®Ê∏ÖÈô§ÂõæÁâáÔºåÈÅøÂÖçËß¶ÂèëÈîôËØØÊèêÁ§∫
  function clearUploadedImage() {
    document.getElementById('previewImage').src = '';
    document.getElementById('previewImage').style.display = 'none';
    document.getElementById('base64Output').value = '';
    document.getElementById('fileInfo').textContent = '';
    document.getElementById('fileInput').value = '';
    toggleCloseButtons();
  }

  // ‚úÖ Ê†áËÆ∞Áî®Êà∑‰∏ªÂä®Ê∏ÖÈô§ÁîüÊàêÂõæÁâá
  function clearGeneratedImage() {
    userClearing = true; // ÂºÄÂßãÊ†áËÆ∞Ê∏ÖÈô§‰∏≠
    const output = document.getElementById('outputImage');
    const downloadBtn = document.getElementById('downloadLink');

    output.src = '';
    output.style.display = 'none';
    document.getElementById('base64Input').value = '';
    downloadBtn.style.display = 'none';
    toggleCloseButtons();

    setTimeout(() => {
      userClearing = false; // Á®çÂêéÂèñÊ∂àÊ†áËÆ∞ÔºåÈÅøÂÖçËØØËß¶ÂÖ∂‰ªñÈÄªËæë
    }, 100);
  }

  function getImageExtension(base64Data) {
    const match = base64Data.match(/^data:image\/(\w+);/);
    return match ? match[1] : 'png';
  }

  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.style.position = 'fixed';
    toast.style.bottom = '20px';
    toast.style.left = '50%';
    toast.style.transform = 'translateX(-50%)';
    toast.style.padding = '12px 24px';
    toast.style.backgroundColor = type === 'error' ? '#ff4444' : '#4CAF50';
    toast.style.color = 'white';
    toast.style.borderRadius = '4px';
    toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    toast.style.zIndex = '1000';
    toast.style.animation = 'fadeIn 0.3s, fadeOut 0.3s 2.7s';
    document.body.appendChild(toast);
    setTimeout(() => {
      toast.style.animation = 'fadeOut 0.3s';
      setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
  }

  function toggleCloseButtons() {
    document.getElementById('closeUploadBtn').style.display =
      document.getElementById('previewImage').style.display === 'block' ? 'flex' : 'none';
    document.getElementById('closeGeneratedBtn').style.display =
      document.getElementById('outputImage').style.display === 'block' ? 'flex' : 'none';
  }
</script>
</body>
</html>